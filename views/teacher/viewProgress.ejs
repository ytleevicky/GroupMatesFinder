<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
</head>

<body>

    <br>

    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/teacher/homepage/<%= userid %>">Home</a></li>
            <li class="breadcrumb-item"><a href="/teacher/<%= userid %>/viewCourse/<%= sectioninfo.in[0].id %>">
                    <%= sectioninfo.in[0].courseID %>: <%= sectioninfo.in[0].courseName %>
                </a></li>
            <li class="breadcrumb-item"><a href="/teacher/<%= userid %>/viewSection/<%= sectioninfo.id %>">
                    Section <%= sectioninfo.sectionNum %>
                </a></li>
            <li class="breadcrumb-item active" aria-current="page">Group Formation Progress
            </li>
        </ol>
    </nav>

    <br>


    <h3><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" fill="currentColor"
            class="bi bi-bar-chart-line text-info" viewBox="0 0 16 16">
            <path
                d="M11 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v12h.5a.5.5 0 0 1 0 1H.5a.5.5 0 0 1 0-1H1v-3a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3h1V7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7h1V2zm1 12h2V2h-2v12zm-3 0V7H7v7h2zm-5 0v-3H2v3h2z" />
        </svg> &nbsp;Group Formation Progress</h3>


    <% if(haveGroup> 0 ){ %>

        <div class="row">

            <div class="col-4">

                <div class="row callout1 callout-default">
                    <h6 class="col-9" style="color: rgb(228, 94, 94);"><svg xmlns="http://www.w3.org/2000/svg"
                            width="25" height="25" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
                            <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                            <path fill-rule="evenodd"
                                d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z" />
                            <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
                        </svg> No. of Students</h6>
                    <h5 class="col-3" style="color: rgb(228, 94, 94);">
                        <%= studentInfo.length %>
                    </h5>
                </div>


                <div class="row callout2 callout-default">
                    <h6 class="col-9" style="color: rgb(41, 168, 79);"><svg xmlns="http://www.w3.org/2000/svg"
                            width="25" height="25" fill="currentColor" class="bi bi-check-square-fill"
                            viewBox="0 0 16 16">
                            <path
                                d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z" />
                        </svg> &nbsp;Have Group</h6>
                    <h5 class="col-3" style="color: rgb(41, 168, 79);">
                        <%= haveGroup %>
                    </h5>
                </div>

                <div class="row callout3 callout-default">
                    <h6 class="col-9" style="color: rgb(44, 105, 141);"><svg xmlns="http://www.w3.org/2000/svg"
                            width="25" height="25" fill="currentColor" class="bi bi-exclamation-triangle-fill"
                            viewBox="0 0 16 16">
                            <path
                                d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
                        </svg> &nbsp;No Group</h6>
                    <h5 class="col-3" style="color: rgb(44, 105, 141);">
                        <%= noGroup %>
                    </h5>
                </div>

            </div>

            <div class="col-4">
                <div class="card">
                    <h5 class="card-header" style="color: rgb(44, 105, 141);">Group Formation
                        Progress</h5>
                    <div class="card-body">
                        <canvas id="myChart" style="display: block;" width="300" height="200"
                            class="chartjs-render-monitor"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="card">
                    <h5 class="card-header" style="color: rgb(44, 105, 141);">Student's
                        Participation</h5>
                    <div class="card-body">
                        <canvas id="myChart2" style="display: block;" width="607" height="400"
                            class="chartjs-render-monitor"></canvas>
                    </div>
                </div>
            </div>
        </div>


        <% } else { %>

            <div class="alert alert-warning" role="alert">
                No relevant information could be displayed at this moment.
            </div>

            <% } %>

                <br>
                <br>
                <br>

                <% if(studentInfo.length> 0) { %>


                    <div class="container">

                        <div class="row">
                            <div class="col">
                                <h3><svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em"
                                        fill="currentColor" class="bi bi-people-fill text-danger" viewBox="0 0 16 16">
                                        <path
                                            d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
                                        <path fill-rule="evenodd"
                                            d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z" />
                                        <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
                                    </svg> &nbsp;Student List</h3>
                            </div>
                            <div class="col-md-6">
                                <div class="input-group input-group-default my-2">
                                    <input type="text" class="form-control" aria-label="Sizing example input"
                                        aria-describedby="inputGroup-sizing-default"
                                        placeholder="Search for student names..." id="myInput" onkeyup="myFunction()">
                                </div>
                            </div>
                            <div class="col col-lg-3">
                                <button type="button" class="btn btn-outline-primary my-2" onclick="sortTable()"
                                    style="float: right;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                        fill="currentColor" class="bi bi-sort-up" viewBox="0 0 16 16">
                                        <path
                                            d="M3.5 12.5a.5.5 0 0 1-1 0V3.707L1.354 4.854a.5.5 0 1 1-.708-.708l2-1.999.007-.007a.498.498 0 0 1 .7.006l2 2a.5.5 0 1 1-.707.708L3.5 3.707V12.5zm3.5-9a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM7.5 6a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 3a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1h-3zm0 3a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z" />
                                    </svg> Sort by Group</button>
                            </div>
                        </div>

                    </div>

                    <form
                        action="/teacher/<%= userid %>/viewSection/<%= sectioninfo.id %>/project/<%= projectid %>/formGroupReminder"
                        method="POST" onsubmit="createForm(this);return false">

                        <!-- Table -->
                        <table class="table table-hover" id="myTable" style="padding: 20px;">

                            <thead class="table-light">
                                <tr>
                                    <th scope="col" span="1" style="width: 15%; text-align: center;">Select
                                        &nbsp; <input type="checkbox" class="form-check-input"
                                            onclick="check_all(this,'remindStudent')">
                                    </th>

                                    <th scope="col" span="1" style="width: 15%;">Student ID:
                                    </th>
                                    <th scope="col" span="1" style="width: 25%;">Student Full Name</th>
                                    <th scope="col" span="1" style="width: 30%;">Email address</th>
                                    <th scope="col" span="1" style="width: 15%;">Group</th>
                                </tr>
                            </thead>

                            <tbody>

                                <% studentInfo.forEach( function(model) { %>

                                    <tr>
                                        <td style="text-align:center">
                                            <input class="form-check-input" type="checkbox" name="remindStudent"
                                                value="<%= model.contact_mail %>" id="defaultCheck1">
                                        </td>

                                        <td>
                                            <%= model.givenId %>
                                        </td>
                                        <td>
                                            <img src="<%= model.imgURL %>" alt="Admin" class="rounded-circle"
                                                width="40">
                                            <%= model.fullName %>
                                        </td>

                                        <td>
                                            <%= model.contact_mail %>
                                        </td>

                                        <td>
                                            <%= model.create.length> 0 ? 'Group ' + model.create[0].groupNum :
                                                'No Group' %>
                                        </td>

                                        <% }); %>
                                    </tr>

                            </tbody>
                        </table>

                        <% } %>

                            <button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal"
                                data-bs-target="#emailModal">
                                Send Reminder
                            </button>



                            <!-- Modal -->
                            <div class="modal fade" id="emailModal" tabindex="-1" aria-labelledby="emailModalLabel"
                                aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="emailModalLabel">Send Reminder - Group formation
                                            </h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            Confirm to send an email reminder to student(s) ?
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Confirm to send</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                    </form>






</body>

<script>

    var ctx = document.getElementById('myChart').getContext('2d');

    // For a pie chart
    var myPieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            datasets: [{
                data: [<%= completedGroupNum %>, <%= inCompletedGroupNum %>],
                backgroundColor: [
                    'rgba(255, 99, 132)',
                    'rgba(255, 206, 86)',

                ],
            }],

            // These labels appear in the legend and in the tooltips when hovering different arcs
            labels: [
                'Completed Group',
                'Incompleted Group',

            ]
        },



    });


    var ctx2 = document.getElementById('myChart2').getContext('2d');

    // For a pie chart
    var myPieChart = new Chart(ctx2, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [<%= haveGroup %>, <%= noGroup %>],
                backgroundColor: [
                    'rgba(0, 142, 204)',
                    'rgba(192, 192, 192)',

                ],
            }],

            // These labels appear in the legend and in the tooltips when hovering different arcs
            labels: [
                'Have Group',
                'No Group',

            ]
        },


    });



    function myFunction() {
        // Declare variables
        var input, filter, table, tr, td, i, txtValue;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        table = document.getElementById("myTable");
        tr = table.getElementsByTagName("tr");

        // Loop through all table rows, and hide those who don't match the search query
        for (i = 0; i < tr.length; i++) {
            td = tr[i].getElementsByTagName("td")[2];
            if (td) {
                txtValue = td.textContent || td.innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                } else {
                    tr[i].style.display = "none";
                }
            }
        }
    }

    function sortTable() {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("myTable");
        switching = true;
        /* Make a loop that will continue until
        no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the
            first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare,
                one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[4];
                y = rows[i + 1].getElementsByTagName("TD")[4];
                // Check if the two rows should switch place:
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    // If so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch
                and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }

    var myModal = document.getElementById('emailModal');

    function checkAnyChecked() {
        if (Array.from(document.querySelectorAll('input[type="checkbox"]')).filter(e => e.checked).length > 0) {
            return true;
        } else {
            alert('Please select at least one student.');
            return false;
        }

    }

    function check_all(obj, cName) {
        var checkboxs = document.getElementsByName(cName);
        for (var i = 0; i < checkboxs.length; i++) { checkboxs[i].checked = obj.checked; }
    }


    async function createForm(oFormElement) {

        var abc = checkAnyChecked();

        if (abc == true) {
            var response = await fetch(oFormElement.action, {
                method: "POST",
                credentials: 'same-origin',
                headers: { 'content-type': 'application/x-www-form-urlencoded' }, //enctype code of form
                //put into array            //map into input and encode                                                         //join it
                body: Array.from(document.querySelectorAll('input[type="checkbox"]')).filter(e => e.checked).map(input => encodeURIComponent(input.name) + '=' + encodeURIComponent(input.value)).join('&'),
            });

            if (response.ok) {
                var data = await response.json();
                alert(data.message);
                window.location = data.url;
            }

        } else {
            return;
        }

    };




</script>

<style>
    .callout1 {
        padding: 20px;
        margin: 20px 0;
        border: 1px solid rgb(228, 94, 94);
        border-left-width: 10px;
        border-radius: 5px;

    }

    .callout2 {
        padding: 20px;
        margin: 20px 0;
        border: 1px solid rgb(41, 168, 79);
        border-left-width: 10px;
        border-radius: 5px;

    }

    .callout3 {
        padding: 20px;
        margin: 20px 0;
        border: 1px solid rgb(44, 105, 141);
        border-left-width: 10px;
        border-radius: 5px;

    }
</style>